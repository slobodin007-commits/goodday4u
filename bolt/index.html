<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unscrew ‚Äî goodday4u.com</title>
<script src="../js/translations.js"></script>
<script src="../js/common.js"></script>
<style>
  :root{--b:#e5e7eb;--t:#111827;--m:#6b7280;}
  body{margin:0;font-family:system-ui;background:#fff;color:var(--t)}
  .main-wrapper{display:flex;max-width:1400px;margin:0 auto;gap:2rem;align-items:flex-start;min-height:100vh;padding:24px}
  .ad-sidebar{width:160px;min-width:160px;position:sticky;top:2rem;display:flex;flex-direction:column;gap:1rem}
  .ad-block{width:160px;min-height:600px;background:#f9f9f9;border:1px solid var(--b);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#999;font-size:0.85rem;text-align:center;padding:1rem}
  .ad-block::before{content:'Ad';font-size:0.75rem;color:#ccc}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;flex:1;max-width:520px;margin:0 auto}
  @media (max-width:1200px){.ad-sidebar{display:none}.main-wrapper{gap:0}}
  .card{width:min(520px,92vw);border:1px solid var(--b);border-radius:22px;padding:18px;text-align:center}
  .muted{color:var(--m);font-size:13px;line-height:1.4}
  .scene{
    width:360px;max-width:92vw;height:520px;margin:14px auto;position:relative;
    border:1px solid var(--b);border-radius:22px;background:#fff;
    display:flex;align-items:center;justify-content:center;
    overflow:hidden;
  }
  #bolt{
    position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);
    width:200px;height:auto;
    filter: drop-shadow(0 16px 24px rgba(0,0,0,.10));
    user-select:none; -webkit-user-drag:none;
    z-index:1;
  }
  #nut{
    position:absolute;left:50%;top:28%;
    width:140px;height:auto;
    transform:translate(-50%, 0) translateY(0px) rotate(90deg);
    transform-origin:50% 50%;
    cursor:grab;
    touch-action:none;
    filter: drop-shadow(0 16px 24px rgba(0,0,0,.10));
    user-select:none; -webkit-user-drag:none;
    transition: transform 0.05s linear, filter 0.1s ease-out;
    z-index:2;
  }
  
  #nut.dropped{
    transition: transform 700ms ease-in;
  }
  #msg{
    display:none;
    position:absolute;left:50%;bottom:16px;transform:translateX(-50%);
    width:92%;max-width:340px;
    border:1px solid var(--b);border-radius:18px;background:#fff;
    padding:12px 14px;font-weight:800;
  }
  .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
  button{border:1px solid var(--b);border-radius:999px;padding:12px 14px;background:#fff;font-weight:700;cursor:pointer}
  .back-link {
    position: absolute;
    top: 1rem;
    left: 1rem;
    color: var(--m);
    text-decoration: none;
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border: 1px solid var(--b);
    border-radius: 8px;
    transition: all 0.2s ease;
    z-index: 10;
  }
  .back-link:hover {
    color: var(--t);
    border-color: #ccc;
  }
  .top-bar {
    display: none;
  }
  
  .bottom-bar {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 1rem;
    flex-wrap: wrap;
    gap: 0.75rem;
    padding-top: 1rem;
    border-top: 1px solid var(--b);
  }
  .top-btn {
    padding: 0.5rem 1rem;
    border: 1px solid var(--b);
    border-radius: 8px;
    background: #fff;
    color: var(--m);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .top-btn:hover {
    color: var(--t);
    border-color: #ccc;
  }
  .lang-selector {
    position: relative;
  }
  .lang-btn {
    padding: 0.5rem 1rem;
    border: 1px solid var(--b);
    border-radius: 8px;
    background: #fff;
    color: var(--m);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .lang-btn:hover {
    color: var(--t);
    border-color: #ccc;
  }
  .lang-menu {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: #fff;
    border: 1px solid var(--b);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,.1);
    display: none;
    flex-direction: column;
    min-width: 150px;
    z-index: 1000;
  }
  .lang-menu.show {
    display: flex;
  }
  .lang-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: background 0.2s ease;
    border: none;
    background: none;
    text-align: left;
    font-size: 0.9rem;
    color: var(--t);
  }
  .lang-option:hover {
    background: #f9f9f9;
  }
  .lang-option.active {
    background: #f0f0f0;
    font-weight: 500;
  }
</style>
</head>
<body>
<div class="wrap">
  <a href="../index.html" class="back-link" data-translate="back">‚Üê Back</a>
  
  <div class="card">
    <h2 style="margin:6px 0 0" data-translate="boltTitle">Unscrew the nut</h2>
    <div class="muted" data-translate="boltHint">Drag left/right to rotate. The nut will unscrew down the bolt.</div>

    <div class="scene" id="scene">
      <img id="bolt" src="./bolt.png" alt="bolt" draggable="false">
      <img id="nut" src="./nut.png" alt="nut" draggable="false">
      <img id="nut2" src="./nut1y.png" alt="nut" draggable="false" style="position:absolute;left:50%;top:28%;width:140px;height:auto;transform:translate(-50%, 0) translateY(0px) rotate(90deg);transform-origin:50% 50%;cursor:grab;touch-action:none;filter: drop-shadow(0 16px 24px rgba(0,0,0,.10));user-select:none;-webkit-user-drag:none;transition: transform 0.05s linear, opacity 0.1s ease;z-index:2;opacity:0;pointer-events:none;">
      <div id="msg" data-translate-html="boltMessage">–¢—ã –¥—É—Ä–∞–∫ üòÑ<br>–ó–∞—á–µ–º —É—Ä–æ–Ω–∏–ª –≥–∞–π–∫—É?</div>
    </div>

    <div class="row">
      <button id="resetBtn" data-translate="reset">‚Ü© Reset</button>
      <button id="muteBtn">üîä Sound: ON</button>
    </div>
    
    <div class="bottom-bar">
      <button class="top-btn" onclick="openDonate()" data-translate="donate">Support</button>
      <div class="lang-selector">
        <button class="lang-btn" id="langBtn" data-translate="language">Language</button>
        <div class="lang-menu" id="langMenu">
          <button class="lang-option" data-lang="en">English</button>
          <button class="lang-option" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
          <button class="lang-option" data-lang="he">◊¢◊ë◊®◊ô◊™</button>
          <button class="lang-option" data-lang="de">Deutsch</button>
          <button class="lang-option" data-lang="cs">ƒåe≈°tina</button>
        </div>
      </div>
      <button class="top-btn" onclick="shareSite()" data-translate="share">Share</button>
    </div>
  </div>
  </div>

  <div class="ad-sidebar ad-right">
    <div class="ad-block" id="adRight">
      <!-- Ad space - 160x600 -->
    </div>
  </div>
</div>

<script>
  const nut = document.getElementById("nut");
  const msg = document.getElementById("msg");
  const resetBtn = document.getElementById("resetBtn");
  const muteBtn = document.getElementById("muteBtn");

  let rot = 0;        // degrees
  let y = 0;          // px - —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ –ø–æ –±–æ–ª—Ç—É –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
  let dropped = false;
  let soundOn = true;
  const MAX_Y = 145;  // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–æ –ø–∞–¥–µ–Ω–∏—è (–ø–∏–∫—Å–µ–ª–∏) - –∫–æ–≥–¥–∞ –≥–∞–π–∫–∞ –≤–Ω–∏–∑—É –±–æ–ª—Ç–∞

  // WebAudio
  let audioCtx = null;
  let squeakSound = null;
  let isSqueakPlaying = false;
  let movementTimeout = null;
  
  async function unlockAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === "suspended") await audioCtx.resume();
  }
  
  function loadSqueakSound(){
    if(squeakSound) return;
    squeakSound = new Audio("./sound_21461.mp3");
    squeakSound.preload = "auto";
    squeakSound.volume = 0.6;
    squeakSound.loop = true;
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
    squeakSound.addEventListener('error', (e) => {
      console.error("Error loading sound:", e);
    });
    squeakSound.addEventListener('canplaythrough', () => {
      console.log("Sound loaded and ready");
    });
  }
  
  function startSqueak(){
    if(!soundOn) return;
    if(!squeakSound) {
      loadSqueakSound();
      // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∑–≤—É–∫–∞
      const tryPlay = () => {
        if(squeakSound.readyState >= 2) { // HAVE_CURRENT_DATA –∏–ª–∏ –≤—ã—à–µ
          if(!isSqueakPlaying) {
            isSqueakPlaying = true;
            squeakSound.currentTime = 0;
            squeakSound.play().catch(error => {
              console.error("Error playing squeak:", error);
              isSqueakPlaying = false;
            });
          }
        } else {
          // –ï—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º —Å–æ–±—ã—Ç–∏—è
          squeakSound.addEventListener('canplay', tryPlay, { once: true });
        }
      };
      tryPlay();
      return;
    }
    if(isSqueakPlaying) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∑–≤—É–∫–∞
    if(squeakSound.readyState < 2) {
      squeakSound.addEventListener('canplay', () => {
        if(!isSqueakPlaying && soundOn) {
          isSqueakPlaying = true;
          squeakSound.currentTime = 0;
          squeakSound.play().catch(error => {
            console.error("Error playing squeak:", error);
            isSqueakPlaying = false;
          });
        }
      }, { once: true });
      return;
    }
    
    isSqueakPlaying = true;
    squeakSound.currentTime = 0;
    const playPromise = squeakSound.play();
    if(playPromise !== undefined) {
      playPromise
        .then(() => {
          console.log("Squeak sound started");
        })
        .catch(error => {
          console.error("Error playing squeak sound:", error);
          isSqueakPlaying = false;
        });
    }
  }
  
  function stopSqueak(){
    if(!squeakSound || !isSqueakPlaying) return;
    isSqueakPlaying = false;
    squeakSound.pause();
    squeakSound.currentTime = 0;
    console.log("Squeak sound stopped");
  }
  
  function beep(freq, dur, type="square", gain=0.03){
    if(!audioCtx || !soundOn) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + dur);
  }
  function clink(){
    beep(260,0.09,"triangle",0.08);
    setTimeout(()=>beep(170,0.14,"sine",0.07),80);
  }

  function apply(){
    if (!dropped) {
      // –ì–∞–π–∫–∞ —Ç–æ–ª—å–∫–æ –¥–≤–∏–∂–µ—Ç—Å—è –≤–Ω–∏–∑/–≤–≤–µ—Ä—Ö, –ø–æ–≤–µ—Ä–Ω—É—Ç–∞ –Ω–∞ 90 –≥—Ä–∞–¥—É—Å–æ–≤
      nut.style.transform = `translate(-50%, 0) translateY(${y}px) rotate(90deg)`;
      nut2.style.transform = `translate(-50%, 0) translateY(${y}px) rotate(90deg)`;
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è
      // –ö–∞–∂–¥—ã–µ ~8 –ø–∏–∫—Å–µ–ª–µ–π –¥–≤–∏–∂–µ–Ω–∏—è –º–µ–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–±–æ–ª–µ–µ —á–∞—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)
      const frameIndex = Math.floor(y / 8) % 2;
      if(frameIndex === 0) {
        nut.style.opacity = "1";
        nut2.style.opacity = "0";
        nut.style.pointerEvents = "auto";
        nut2.style.pointerEvents = "none";
      } else {
        nut.style.opacity = "0";
        nut2.style.opacity = "1";
        nut.style.pointerEvents = "none";
        nut2.style.pointerEvents = "auto";
      }
    }
  }

  function drop(){
    dropped = true;
    nut.classList.add('dropped');
    // –í—Ä–∞—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
    rot = 720;
    // –ü–∞–¥–µ–Ω–∏–µ –≤–Ω–∏–∑ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞
    y = MAX_Y + 200;
    nut.style.transform = `translate(-50%, 0) translateY(${y}px) rotate(${rot}deg)`;
    nut2.style.transform = `translate(-50%, 0) translateY(${y}px) rotate(${rot}deg)`;
    clink();
    setTimeout(()=>{ msg.style.display="block"; }, 650);
  }

  let lastX = null;
  let isDragging = false;

  function handlePointerDown(e) {
    if(dropped) return;
    e.preventDefault();
    const target = e.target;
    target.setPointerCapture(e.pointerId);
    isDragging = true;
    lastX = e.clientX;
    unlockAudio();
    loadSqueakSound();
  }

  nut.addEventListener("pointerdown", handlePointerDown);
  nut2.addEventListener("pointerdown", handlePointerDown);

  function handlePointerMove(e) {
    if(dropped || !isDragging) return;
    if(e.buttons !== 1 && e.pointerType !== 'mouse') {
      // –î–ª—è touch —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞—Ö–≤–∞—Ç–∞
      if(!e.isPrimary) return;
    }

    const currentX = e.clientX;
    if(lastX === null) {
      lastX = currentX;
      return;
    }

    // rotate by horizontal drag
    const deltaX = currentX - lastX;
    rot += deltaX * 2.4;
    lastX = currentX;

    // "thread": –≥–∞–π–∫–∞ –¥–≤–∏–∂–µ—Ç—Å—è –ø–æ —Ä–µ–∑—å–±–µ –±–æ–ª—Ç–∞
    // –ü–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ (deltaX > 0, rot —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è) - –æ—Ç–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ (y —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è)
    // –ü—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–∏ (deltaX < 0, rot —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è) - –∑–∞–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ (y —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è)
    // 2.5 –≥—Ä–∞–¥—É—Å–æ–≤ –Ω–∞ –ø–∏–∫—Å–µ–ª—å —Å–º–µ—â–µ–Ω–∏—è
    y = Math.max(0, Math.min(MAX_Y, rot / 2.5));

    apply();

    // –ó–≤—É–∫ —Å–∫—Ä–∏–ø–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º
    if(Math.abs(deltaX) > 1) {
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
      startSqueak();
      
      // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
      if(movementTimeout) {
        clearTimeout(movementTimeout);
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–≤—É–∫–∞ —á–µ—Ä–µ–∑ 50ms –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è
      movementTimeout = setTimeout(() => {
        stopSqueak();
      }, 50);
    }

    // –ö–æ–≥–¥–∞ –≥–∞–π–∫–∞ —Å–ø—É—Å—Ç–∏–ª–∞—Å—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—É—á–µ–Ω–∞), –æ–Ω–∞ –ø–∞–¥–∞–µ—Ç
    if(y >= MAX_Y && !dropped) {
      drop();
    }
  }

  document.addEventListener("pointermove", handlePointerMove);

  function handlePointerUp() {
    isDragging = false;
    lastX = null;
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤—É–∫ –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏
    stopSqueak();
    if(movementTimeout) {
      clearTimeout(movementTimeout);
      movementTimeout = null;
    }
  }

  function handlePointerCancel() {
    isDragging = false;
    lastX = null;
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤—É–∫ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ
    stopSqueak();
    if(movementTimeout) {
      clearTimeout(movementTimeout);
      movementTimeout = null;
    }
  }

  nut.addEventListener("pointerup", handlePointerUp);
  nut2.addEventListener("pointerup", handlePointerUp);
  nut.addEventListener("pointercancel", handlePointerCancel);
  nut2.addEventListener("pointercancel", handlePointerCancel);

  resetBtn.addEventListener("click", () => {
    dropped = false;
    msg.style.display = "none";
    nut.classList.remove('dropped');
    nut.style.transition = "transform 300ms ease-out";
    nut2.style.transition = "transform 300ms ease-out, opacity 0.1s ease";
    rot = 0; 
    y = 0;
    nut.style.opacity = "1";
    nut2.style.opacity = "0";
    apply();
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º transition –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
      nut.style.transition = "transform 0.05s linear";
      nut2.style.transition = "transform 0.05s linear, opacity 0.1s ease";
    }, 300);
  });

  muteBtn.addEventListener("click", async () => {
    await unlockAudio();
    soundOn = !soundOn;
    const t = translations[currentLang] || translations['en'];
    muteBtn.textContent = soundOn ? t.soundOn : t.soundOff;
  });

  // Language selector
  const langBtn = document.getElementById('langBtn');
  const langMenu = document.getElementById('langMenu');
  const langOptions = langMenu.querySelectorAll('.lang-option');

  langBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    langMenu.classList.toggle('show');
  });

  document.addEventListener('click', (e) => {
    if (!langMenu.contains(e.target) && e.target !== langBtn) {
      langMenu.classList.remove('show');
    }
  });

  langOptions.forEach(option => {
    option.addEventListener('click', () => {
      const lang = option.getAttribute('data-lang');
      setLanguage(lang);
      langMenu.classList.remove('show');
      
      langOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      
      // Update dynamic texts
      const t = translations[currentLang] || translations['en'];
      muteBtn.textContent = soundOn ? t.soundOn : t.soundOff;
    });
  });

  // Set active language on load
  window.addEventListener('DOMContentLoaded', () => {
    const currentLang = localStorage.getItem('language') || 'en';
    langOptions.forEach(opt => {
      if (opt.getAttribute('data-lang') === currentLang) {
        opt.classList.add('active');
      }
    });
    const t = translations[currentLang] || translations['en'];
    muteBtn.textContent = soundOn ? t.soundOn : t.soundOff;
  });
</script>
</body>
</html>
